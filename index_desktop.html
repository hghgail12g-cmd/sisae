<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SissyCare v5 ‚Äî Desktop</title>
<style>

  :root{
    --bg:#fff8fc;
    --card:#ffffff;
    --primary:#e66ec7;
    --primary-2:#c455a9;
    --accent:#8b80f9;
    --ink:#1f2937;
    --muted:#6b7280;
    --ok:#10b981;
    --warn:#f59e0b;
    --danger:#ef4444;
    --shadow:0 12px 28px rgba(0,0,0,.08);
    --radius:18px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:linear-gradient(180deg,#ffe5f4,#ffffff)}
  a{color:var(--accent);text-decoration:none}
  header{position:sticky;top:0;z-index:10;background:linear-gradient(90deg,var(--primary),var(--accent));color:#fff;padding:16px 18px;box-shadow:var(--shadow);}
  .container{max-width:1200px;margin:18px auto;padding:0 16px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:36px;height:36px;border-radius:50%;background:#fff3;border:2px solid #fff8;display:grid;place-items:center;font-weight:900}
  .brand h1{margin:0;font-size:20px}
  .brand small{opacity:.9}
  nav.tabs{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0}
  nav.tabs button{border:0;background:#fff;border:1px solid #eee;border-bottom:3px solid transparent;padding:10px 14px;border-radius:12px;cursor:pointer;box-shadow:var(--shadow);font-weight:700}
  nav.tabs button.active{border-bottom-color:var(--accent);color:var(--accent)}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
  .card{background:var(--card);border:1px solid #eee;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
  .kpi{display:flex;align-items:center;justify-content:space-between}
  .kpi h3{margin:0;font-size:14px;color:var(--muted);font-weight:700}
  .kpi .big{font-size:24px;font-weight:900}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  label{display:block;font-size:13px;color:#374151;margin:8px 0 6px}
  input[type=text],input[type=time],input[type=number],textarea,select{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:12px;background:#fafafa;outline:none}
  textarea{min-height:90px}
  .btn{display:inline-flex;align-items:center;gap:8px;border:0;padding:10px 14px;border-radius:12px;background:var(--primary);color:#fff;cursor:pointer;font-weight:800;box-shadow:var(--shadow)}
  .btn.secondary{background:#1118270d;color:#111827;border:1px solid #e5e7eb}
  .btn.ok{background:var(--ok)} .btn.warn{background:var(--warn)} .btn.danger{background:var(--danger)}
  .section{display:none}
  .section.active{display:block}
  .chat{height:380px;overflow:auto;border:1px solid #eee;border-radius:14px;padding:12px;background:#fff}
  .bubble{max-width:75%;padding:10px 12px;border-radius:12px;margin:6px 0;box-shadow:var(--shadow);}
  .me{background:#eef2ff;margin-left:auto}
  .ai{background:#fff0fa}
  .muted{color:var(--muted)}
  .pill{display:inline-block;background:#f5f3ff;color:#4f46e5;border-radius:999px;padding:4px 10px;font-size:12px;margin:3px 6px 0 0}
  .badge{display:inline-flex;align-items:center;gap:6px;background:#fff;border:1px dashed #e5e7eb;border-radius:14px;padding:8px 10px;margin:6px 6px 0 0}
  .badge .dot{width:10px;height:10px;border-radius:50%;background:var(--ok)}
  .list{list-style:none;padding:0;margin:0}
  .list li{display:flex;align-items:center;justify-content:space-between;padding:10px;border:1px solid #eee;border-radius:12px;margin-top:8px;background:#fff}
  .right{margin-left:auto}
  .thumb{width:90px;height:90px;border-radius:12px;object-fit:cover;border:1px solid #eee}
  .hint{font-size:12px;color:var(--muted)}
  .footer-note{font-size:12px;color:#6b7280;text-align:center;margin:18px 0}
  .code{white-space:pre-wrap;background:#111827; color:#f3f4f6; padding:10px;border-radius:10px; font-family: ui-monospace, Menlo, Monaco, Consolas, "Courier New", monospace;}
  .pdf{width:100%;height:520px;border:1px solid #eee;border-radius:14px}
  .top-pills{display:flex;flex-wrap:wrap;gap:8px}
  audio{display:none}

  .columns{grid-template-columns: 2fr 1fr;}
</style>
</head>
<body>
<header>
  <div class="container row" style="justify-content:space-between">
    <div class="brand">
      <div class="logo">‚ôÄ</div>
      <div><h1>SissyCare ‚Äî Feminization Coach</h1><small>Desktop ‚Ä¢ Local & Sync-ready</small></div>
    </div>
    <div class="top-pills">
      <span class="pill" id="pill-hydration">üíß 0 / 8 cups</span>
      <span class="pill" id="pill-sleep">üõèÔ∏è target 23:00</span>
      <span class="pill" id="pill-chastity">üîí idle</span>
      <span class="pill" id="pill-diaper">üçº Every 3 hours</span>
    </div>
  </div>
</header>

<div class="container">
  <nav class="tabs">
    <button class="active" data-tab="dashboard">Dashboard</button>
    <button data-tab="meals">Meals</button>
    <button data-tab="workouts">Workouts</button>
    <button data-tab="care">Care Routine</button>
    <button data-tab="hormonal">Hormonal Foods</button>
    <button data-tab="progress">Progress</button>
    <button data-tab="chat">Nanny Chat</button>
    <button data-tab="settings">Settings</button>
  </nav>

  <!-- DASHBOARD -->
  <section id="dashboard" class="section active">
    <div class="grid">
      <div class="card" style="grid-column: span 8;">
        <div class="kpi"><h3>Today‚Äôs Actions</h3><span class="hint">Quick buttons</span></div>
        <div class="row" style="margin:8px 0 12px">
          <button class="btn secondary" onclick="incWater()">+ Water</button>
          <button class="btn secondary" onclick="logCheck('diaper')">Diaper check</button>
          <button class="btn secondary" onclick="toggleChastity()">Chastity start/stop</button>
          <button class="btn secondary" onclick="startButtPlug()">Butt plug 1h</button>
        </div>
        <ul class="list" id="todayLog"></ul>
      </div>
      <div class="card" style="grid-column: span 4;">
        <div class="kpi"><h3>Badges</h3><span class="hint">Earn by consistency</span></div>
        <div id="badges" style="margin-top:8px"></div>
      </div>

      <div class="card" style="grid-column: span 12;">
        <div class="kpi"><h3>Current Nanny Prompt</h3><span class="hint right"><button class="btn secondary" onclick="copyPrompt()">Copy</button></span></div>
        <pre id="currentPrompt" class="code"></pre>
      </div>
    </div>
  </section>

  <!-- MEALS -->
  <section id="meals" class="section">
    <div class="grid">
      <div class="card" style="grid-column: span 12;">
        <h3>Meal Plans (4 Weeks)</h3>
        <iframe class="pdf" src="Meal_Plans_4_Weeks.pdf"></iframe>
        <div class="hint">Meals auto-focus on slim arms/waist and fuller hips/thighs.</div>
      </div>
      <div class="card" style="grid-column: span 12;">
        <h3>Preparation & Cooking Guide</h3>
        <iframe class="pdf" src="Meal_Preparation_and_Cooking_Guide.pdf"></iframe>
      </div>
    </div>
  </section>

  <!-- WORKOUTS -->
  <section id="workouts" class="section">
    <div class="grid">
      <div class="card" style="grid-column: span 12;">
        <h3>Workout Guide (Feminine Focus)</h3>
        <iframe class="pdf" src="Workout_Guide.pdf"></iframe>
      </div>
    </div>
  </section>

  <!-- CARE ROUTINE -->
  <section id="care" class="section">
    <div class="grid">
      <div class="card" style="grid-column: span 12;">
        <h3>Care & Beauty Routine</h3>
        <iframe class="pdf" src="Care_and_Beauty_Routine.pdf"></iframe>
      </div>
      <div class="card" style="grid-column: span 12;">
        <h3>Daily & Monthly Checklists</h3>
        <iframe class="pdf" src="Daily_and_Monthly_Checklists.pdf"></iframe>
      </div>
    </div>
  </section>

  <!-- HORMONAL FOODS -->
  <section id="hormonal" class="section">
    <div class="grid">
      <div class="card" style="grid-column: span 12;">
        <h3>Hormonal Foods & Lifestyle</h3>
        <iframe class="pdf" src="Hormonal_Foods_and_Lifestyle.pdf"></iframe>
      </div>
    </div>
  </section>

  <!-- PROGRESS -->
  <section id="progress" class="section">
    <div class="grid" id="galleryGrid"></div>
  </section>

  <!-- CHAT -->
  <section id="chat" class="section">
    <div class="grid">
      <div class="card" style="grid-column: span 12;">
        <div class="row" style="justify-content:space-between">
          <h3>Nanny Chat</h3>
          <div class="row">
            <input id="apiKey" type="text" placeholder="DeepSeek API key sk-..." style="min-width:300px"/>
            <button class="btn secondary" onclick="testAPI()">Test API</button>
          </div>
        </div>
        <div class="chat" id="chatBox"></div>
        <div class="row" style="margin-top:8px">
          <input id="msg" type="text" placeholder="Type a message"/>
          <input id="imgCap" type="text" placeholder="Optional image caption"/>
          <input id="file" type="file" accept="image/*"/>
          <button class="btn" onclick="send()">Send</button>
        </div>
        <p class="hint">If PDFs don‚Äôt show or API is blocked, serve locally: <span class="code">python -m http.server 8000</span> ‚Üí open <span class="code">http://localhost:8000/index_desktop.html</span></p>
      </div>
    </div>
  </section>

  <!-- SETTINGS -->
  <section id="settings" class="section">
    <div class="grid">
      <div class="card" style="grid-column: span 6;">
        <h3>Profile</h3>
        <label>Name <input id="p_name" type="text"/></label>
        <label>Age <input id="p_age" type="number"/></label>
        <label>Gender <input id="p_gender" type="text"/></label>
        <label>Sleep schedule <input id="p_sleep" type="text"/></label>
        <label>Study schedule <input id="p_study" type="text"/></label>
        <label>Goals <textarea id="p_goals"></textarea></label>
        <label>Favorite foods <textarea id="p_likes"></textarea></label>
        <label>Disliked foods <textarea id="p_dislikes"></textarea></label>
        <label>Cage type <input id="p_cage" type="text"/></label>
        <label>Cage schedule <input id="p_cageTimes" type="text"/></label>
        <label>Diaper interval <input id="p_diaper" type="text"/></label>
        <label>Butt plug training <input id="p_plug" type="text"/></label>
        <div class="row"><button class="btn" onclick="generatePrompt()">Generate Nanny Prompt</button><button class="btn secondary" onclick="saveProfile()">Save</button></div>
      </div>
      <div class="card" style="grid-column: span 6;">
        <h3>System Prompt</h3>
        <textarea id="manualPrompt"></textarea>
        <div class="row"><button class="btn" onclick="saveManualPrompt()">Save Prompt</button><button class="btn secondary" onclick="copyPrompt()">Copy</button></div>
        <div class="kpi" style="margin-top:12px"><h3>Sync (LAN)</h3><span class="hint">Run Flask server</span></div>
        <label>Sync URL (e.g., http://PC-IP:5000) <input id="syncUrl" type="text"/></label>
        <label>Sync Token (set in server) <input id="syncToken" type="text"/></label>
        <div class="row"><button class="btn ok" onclick="syncPush()">Push to server</button><button class="btn warn" onclick="syncPull()">Pull from server</button></div>
      </div>
    </div>
  </section>

  <div class="footer-note">Feminization logo & UI by SissyCare ‚Ä¢ Keep safety first ‚Ä¢ If any pain/numbness in training, stop.</div>
</div>

<audio id="ding" src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAA..."></audio>
<script>

// ------- NAV ------
document.querySelectorAll('nav.tabs button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('nav.tabs button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const tab=btn.dataset.tab;
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.getElementById(tab).classList.add('active');
  })
});

// ------- STORAGE -------
const S = {
  get(k, fallback){ try{ return JSON.parse(localStorage.getItem(k)) ?? fallback }catch(e){ return fallback } },
  set(k,v){ localStorage.setItem(k, JSON.stringify(v)) }
};

// ------- PROFILE DEFAULT -------
function defaultProfile(){
  return {
    name:"abod",
    age:19,
    gender:"male",
    goals:"Slim arms and waist; Bigger thighs and hips; Feminine chest (soft, no hard muscles); Daily chastity discipline; Obedience and sissy baby training",
    likes:"Soy milk; Tofu; Oats with almond milk; Bananas, berries, apples; Smoothies; Olive oil",
    dislikes:"Lentils; Beans; Broccoli (but I will eat if necessary)",
    sleep:"Bedtime: 11 PM  Wake up: 7 AM",
    study:"University: Monday‚ÄìThursday, 7 AM ‚Äì 4 PM; Study at home: 6 PM ‚Äì 8 PM",
    cage:"Nub size, plastic pink cage",
    cageTimes:"Start 08:00, End 22:00 (daily)",
    diaper:"Every 3 hours",
    plug:"Small plug, 1 hour per day; Increase size after 2 weeks"
  }
}

// ------- PROMPT -------
function seedPrompt(){
  if(!localStorage.getItem('systemPrompt')){
    S.set('systemPrompt', `You are a caring but strict nanny AI. 
Here is the user's profile:
- Name: abod
- Age: 19
- Gender: male
- Goals: Slim arms and waist; Bigger thighs and hips; Feminine chest appearance (soft, no hard muscles); Daily chastity discipline; Obedience and sissy baby training
- Favorite Foods: Soy milk; Tofu; Oats with almond milk; Bananas, berries, apples; Smoothies; Olive oil
- Disliked Foods: Lentils; Beans; Broccoli (but I will eat if necessary)
- Sleep: Bedtime: 11 PM  Wake up: 7 AM
- Chastity Cage: Nub size, plastic pink cage
- Diaper Check Interval: Every 3 hours
- Butt Plug Training: Small plug, 1 hour per day  Increase size after 2 weeks
- Study Schedule: University: Monday‚ÄìThursday, 7 AM ‚Äì 4 PM  Study time at home: 6 PM ‚Äì 8 PM

Your duties every day:
- Greet the user, give daily plan.
- Remind meals, hydration, workouts, skincare, diaper checks, chastity, butt plug training, and bedtime.
- Encourage discipline and consistency while being kind.
- Comment on shared images as progress checks.
- Never use roleplay actions like *pats head*. Only clear text guidance.
- Tone: motherly, soft, supportive, but strict when needed.`);
  }
}

// ------- DASHBOARD -------
function hydrateHeader(){
  const p = S.get('profile', defaultProfile());
  document.getElementById('pill-sleep').textContent = 'üõèÔ∏è target ' + (p.sleep||'23:00');
  document.getElementById('pill-diaper').textContent = 'üçº ' + (p.diaper||'Every 3 hours');
  document.getElementById('pill-chastity').textContent = S.get('chastityOn', false)?'üîí active':'üîí idle';
  document.getElementById('pill-hydration').textContent = 'üíß ' + (S.get('water',0)) + ' / 8 cups';
}
function incWater(){ const w=S.get('water',0)+1; S.set('water',w); document.getElementById('pill-hydration').textContent='üíß '+w+' / 8 cups'; log('Water +1'); award('Hydrated'); ding(); }
function logCheck(kind){ log(kind==='diaper'?'Diaper check ‚úÖ':'Check'); award('Diaper Diligence'); ding(); }
let chastityOn = S.get('chastityOn', false);
function toggleChastity(){ chastityOn=!chastityOn; S.set('chastityOn',chastityOn); document.getElementById('pill-chastity').textContent=chastityOn?'üîí active':'üîí idle'; log(chastityOn?'Chastity: started':'Chastity: ended'); award('Chastity Discipline'); ding(); }
function startButtPlug(){ const dur=60*60*1000; const end=Date.now()+dur; S.set('plugEnd', end); log('Butt plug: timer started (1h)'); award('Plug Discipline'); ding(); }
function log(text){ const logs=S.get('today',[]); logs.unshift({t:new Date().toLocaleTimeString(), text}); S.set('today',logs); renderToday(); }
function renderToday(){ const logs=S.get('today',[]); const ul=document.getElementById('todayLog'); if(!ul) return; ul.innerHTML=logs.map(x=>`<li><span>${x.t}</span><span>${x.text}</span></li>`).join(''); }

// ------- BADGES -------
function award(name){ const b=S.get('badges',{}); b[name]=(b[name]||0)+1; S.set('badges',b); renderBadges(); }
function renderBadges(){ const b=S.get('badges',{}); const div=document.getElementById('badges'); if(!div) return; div.innerHTML=''; Object.keys(b).forEach(k=>{ const el=document.createElement('span'); el.className='badge'; el.innerHTML=`<span class="dot"></span><b>${k}</b> √ó ${b[k]}`; div.appendChild(el); }); }

// ------- CHECKLIST -------
function loadChecklist(){ const items=S.get('checklist', ["Morning skincare","Breakfast","Hydration (8 cups)","Workout (glutes & thighs)","Diaper check","Chastity on-time","Butt plug training","Study 2h","Evening skincare","Bedtime 11 PM"]); const ul=document.getElementById('checklist'); if(!ul) return; ul.innerHTML=''; items.forEach((t,i)=>{ const li=document.createElement('li'); li.innerHTML=`<span>${t}</span><span class="row"><button class="btn secondary" onclick="doneTask(${i})">Done</button><button class="btn danger" onclick="delTask(${i})">Delete</button></span>`; ul.appendChild(li); }); S.set('checklist',items); }
function addTask(){ const t=document.getElementById('newTask').value.trim(); if(!t) return; const items=S.get('checklist',[]); items.push(t); S.set('checklist',items); document.getElementById('newTask').value=''; loadChecklist(); }
function delTask(i){ const items=S.get('checklist',[]); items.splice(i,1); S.set('checklist',items); loadChecklist(); }
function doneTask(i){ const items=S.get('checklist',[]); items[i]='‚úîÔ∏è '+items[i]; S.set('checklist',items); loadChecklist(); award('Task Streak'); ding(); }
function resetChecklist(){ localStorage.removeItem('checklist'); loadChecklist(); }

// ------- GALLERY -------
function addToGallery(dataUrl, cap){ const g=S.get('gallery',[]); g.unshift({img:dataUrl, cap, t:new Date().toLocaleString()}); S.set('gallery',g); renderGallery(); }
function renderGallery(){ const g=S.get('gallery',[]); const grid=document.getElementById('galleryGrid'); if(!grid) return; grid.innerHTML=g.map(item=>`<div class="card" style="grid-column: span 3; text-align:center"><img class="thumb" src="${item.img}"/><div class="hint">${item.cap||''}</div><div class="hint">${item.t}</div></div>`).join(''); }

// ------- PROFILE FORM -------
function loadProfile(){ const p=S.get('profile', defaultProfile()); ['name','age','gender','goals','likes','dislikes','sleep','study','cage','cageTimes','diaper','plug'].forEach(k=>{ const el=document.getElementById('p_'+k); if(el){ el.value=p[k]||''; } }); }
function saveProfile(){ const p={}; ['name','age','gender','goals','likes','dislikes','sleep','study','cage','cageTimes','diaper','plug'].forEach(k=>{ const el=document.getElementById('p_'+k); if(el){ p[k]=el.type==='number'? +el.value||'' : el.value; } }); S.set('profile',p); alert('Profile saved'); }

// ------- PROMPT GEN -------
function generatePrompt(){ const p=S.get('profile', defaultProfile()); const prompt = `You are a caring but strict nanny AI. 
Here is the user's profile:
- Name: ${p.name}
- Age: ${p.age}
- Gender: ${p.gender}
- Goals: ${p.goals}
- Favorite Foods: ${p.likes}
- Disliked Foods: ${p.dislikes}
- Sleep: ${p.sleep}
- Chastity Cage: ${p.cage}
- Diaper Check Interval: ${p.diaper}
- Butt Plug Training: ${p.plug}
- Study Schedule: ${p.study}

Your duties every day:
- Greet the user, give daily plan.
- Remind meals, hydration, workouts, skincare, diaper checks, chastity, butt plug training, and bedtime.
- Encourage discipline and consistency while being kind.
- Comment on shared images as progress checks.
- Never use roleplay actions like *pats head*. Only clear text guidance.
- Tone: motherly, soft, supportive, but strict when needed.`; 
  S.set('systemPrompt',prompt); renderPrompt(); alert('Prompt generated'); }
function renderPrompt(){ const p=S.get('systemPrompt',''); const pre=document.getElementById('currentPrompt'); if(pre) pre.textContent=p||'No prompt yet.'; const ta=document.getElementById('manualPrompt'); if(ta) ta.value=p; }
function saveManualPrompt(){ S.set('systemPrompt', document.getElementById('manualPrompt').value); renderPrompt(); alert('Prompt saved'); }
function copyPrompt(){ navigator.clipboard.writeText(S.get('systemPrompt','')); alert('Copied'); }

// ------- CHAT / API -------
function appendBubble(text, who){ const div=document.createElement('div'); div.className='bubble '+(who==='me'?'me':'ai'); div.textContent=text; const box=document.getElementById('chatBox'); if(box){ box.appendChild(div); box.scrollTop=box.scrollHeight; } }
async function talkToAPI(key, systemPrompt, userText){
  if(!key){ appendBubble('No API key set.', 'ai'); return }
  try{
    const resp = await fetch('https://api.deepseek.com/v1/chat/completions',{
      method:'POST',
      headers:{'Content-Type':'application/json','Authorization':'Bearer '+key},
      body: JSON.stringify({ model:'deepseek-chat', messages:[{role:'system',content:systemPrompt||'You are a helpful nanny.'},{role:'user',content:userText}] })
    });
    if(!resp.ok){ appendBubble('API error '+resp.status+'. If blocked by CORS, serve over http.', 'ai'); return }
    const data = await resp.json(); const text = data.choices?.[0]?.message?.content || '[No reply]'; appendBubble(text,'ai');
  }catch(e){ appendBubble('Network error: '+e.message,'ai'); }
}
function send(){ const m=document.getElementById('msg').value.trim(); const cap=document.getElementById('imgCap')?.value.trim(); const file=document.getElementById('file')?.files[0]; if(!m && !file) return; if(m) appendBubble(m,'me'); const sys=S.get('systemPrompt',''); const key=(document.getElementById('apiKey')?.value||'').trim(); if(file){ const r=new FileReader(); r.onload=function(){ addToGallery(r.result, cap||'Image'); appendBubble('[Image uploaded] '+(cap||''),'me'); talkToAPI(key, sys, (m?m+'\n':'')+(cap?`User image note: ${cap}`:'User shared an image.')); }; r.readAsDataURL(file); } else { talkToAPI(key, sys, m); } document.getElementById('msg').value=''; if(document.getElementById('imgCap')) document.getElementById('imgCap').value=''; if(document.getElementById('file')) document.getElementById('file').value=''; }
function testAPI(){ const key=(document.getElementById('apiKey')?.value||'').trim(); if(!key){ alert('Enter API key'); return } appendBubble('Testing API‚Ä¶','ai'); talkToAPI(key, S.get('systemPrompt',''), 'Say hi and confirm you can read my profile.'); }

// ------- PDF HELP -------
function pdfNotice(){ return `<div class="hint">Place the PDF files in the same folder and open this page via a local server (python -m http.server) or Flask to allow embedding.</div>`; }

// ------- SYNC (LAN via Flask) -------
async function syncPull(){ const url=(document.getElementById('syncUrl')?.value||'').trim(); const token=(document.getElementById('syncToken')?.value||'').trim(); if(!url||!token){ alert('Set Sync URL and Token'); return } try{ const r=await fetch(url+'/api/state?token='+encodeURIComponent(token)); if(!r.ok){ alert('Sync pull failed: '+r.status); return } const data=await r.json(); Object.keys(data).forEach(k=>S.set(k,data[k])); alert('Pulled & applied.'); location.reload(); }catch(e){ alert('Network error: '+e.message); } }
async function syncPush(){ const url=(document.getElementById('syncUrl')?.value||'').trim(); const token=(document.getElementById('syncToken')?.value||'').trim(); if(!url||!token){ alert('Set Sync URL and Token'); return } const payload={ profile:S.get('profile',defaultProfile()), systemPrompt:S.get('systemPrompt',''), checklist:S.get('checklist',[]), today:S.get('today',[]), badges:S.get('badges',{}), gallery:S.get('gallery',[]), water:S.get('water',0), chastityOn:S.get('chastityOn',false), plugEnd:S.get('plugEnd',null) }; try{ const r=await fetch(url+'/api/state?token='+encodeURIComponent(token),{method:'PUT', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)}); if(!r.ok){ alert('Sync push failed: '+r.status); return } alert('Synced to server.'); }catch(e){ alert('Network error: '+e.message); } }

// ------- DING -------
function ding(){ const a=document.getElementById('ding'); if(a){ a.currentTime=0; a.play().catch(()=>{}); } }

// ------- INIT -------
function init(){
  if(!localStorage.getItem('profile')) S.set('profile', defaultProfile());
  seedPrompt();
  hydrateHeader(); renderToday(); renderBadges(); loadChecklist(); renderPrompt(); renderGallery();
}
window.addEventListener('load', init);

</script>
</body>
</html>
